## Software

The software component of this project is a tool that chooses an optimal set of polling locations from a set of potential locations. Optionally, it also gives a "best case scenario" by searching among the centroids of census block groups, which don't correspond to buildings or street corners, but are suggestive of what an ideal distribution might look like.

Unlike other optimization tools out there, which minimize the mean distance traveled or the maximal distance traveled, this tool (which minimizes the [Kolm-Pollak](references.md), or KP, distance) does a bit of both.

The ```result analysis``` folder is an illustrative example of the type of analysis that can be done with the data generated by this code. The analysis code is in R.


### Example
In the following table, the first three rows have the same mean, while the last three rows have the same maximal distance traveled. The KP minimizing optimization allows the user to set an *aversion to inequality ($\beta$)* parameter that defines a tradeoff between mean and standard deviation of the distances traveled. For a large enough $\beta$, the optimization will choose the last distribution. For a smaller $\beta$, it will choose the second row.

| Distances traveled  | Mean minimizing | Max minimizing | KP minimizing|
| ----- | ------ | ----- | ------ |
|.25, .25, .25, .25, 4 | Yes | | |
| .5, .5, .5, .5, 3| Yes | Yes | Depending on $\beta$ |
| .25, .25, .5, 1, 3 | Yes | Yes | Depending on $\beta$ |
| .5, .5, .5, .75, 3 |  | Yes |  |

### How it works
Given a set of existing and candidate polling locations, output the most equitable (by Kolm-Pollak distance) set of polling locations. The outputs of this model can be used to measure inequity among different racial groups in terms of access to polls (measured solely in terms of distance) and investigate how changes in choices and number of polling locations would change these inequities.

The algorithm for this model is as follows:
1. Create a list of potential polling locations
    
    - Start with a list of historical polling locations
    - Add to this a list of  buildings where one could feasibly site future polling locations
    - Combine this data with a list of "best case scenario" polling locations, modeled by census block *group* centroids

1. Compute the distance from the centroid of each census block (representing residences) to each potential polling location (building or best case scenario)
    - We average over census blocks rather than individual houses for computational feasibility

1. Compute the Kolm-Pollak weight from each block group to each polling location
    - KP_factor  = $e^{(- \beta * \alpha * distance)}$
        - $\beta$ is a user defined parameter
        - $\alpha$ is a data derived normalization factor:
        $$
            \alpha\ = 
            {\sum (block\hspace{1ex}population * distance\hspace{1ex}to\hspace{1ex}closest\hspace{1ex}poll) 
            \over
            \sum (block\hspace{1ex}population * distance\hspace{1ex}to\hspace{1ex}closest\hspace{1ex}poll^2)}
        $$

    - The KP_factor plays the role of a weighted distance in a standard objective function.
        1. The exponential in the KP_factor penalizes inequality in distances traveled
        1. For instance a group of 5 people all having to travel 1 mile to a polling location would have a lower KP_factor than a situation where 4 people travel 1/2 a mile while the fifth travels 3, even though the average distance traveled in both cases is the same.

1. Choose whether to minimize the average distance or the inequity penalized score ($Y_{EDE}$) in the model
    - Set $\beta$ = 0 for average distance
        - In this case, minimize the average distance traveled
    - Set $\beta$ in [-2, 0) for the inequity penalized score ($Y_{EDE}$). The lower the $\beta$, the greater penalty to inequality
        - In this case, minimize $\sum ({block\hspace{1ex}population * KPfactor \over county\hspace{1ex}population} )$

1. Minimize the above according to the following constraints:
    1. Can only have a user specified number of polling locations open
    1. A user defined bound on the number of new locations
        - Some maximal percent allowed to be new
        - Some minimal percent that must have been a polling location in the past
        - This can be easily modified to accommodate other needs (for example, require existing locations to remain open)
    1. Each census block can only be matched to one polling location
    1. Each census block must be matched to a single open precinct
    1. A user defined overcrowding constraint
1
. The model returns a list of matchings between census blocks and polling locations, along with the distance between the two, and a demographic breakdown of the population.

1. The model then uses this matching and demographic data to compute a new data derived scaling factor (alpha), which it then uses to compute the inequity penalized score (y_EDE) for the matched system.

### A FEW THINGS TO NOTE:
1. Currently, this model is run on census data, which counts voting age population. We make no assumptions about eligibility to vote, either in terms of citizenship, local disqualification laws or voter registration status.

1. When this model reports racial demographics, it uses Census categories for race and ethnicity. Namely, Ethnicity (Hispanic / Non-Hispanic) is orthogonal to race in the census data. Therefore, one may be Hispanic and Asian at the same time.

