## Output datasets

For each set of parameters specified in a config_name, the program produces a results datase, and three derivative data sets for ease of analysis later. These output datasets are named results, edes, precinct_distances and residence_distances.

These are stored locally, in `datasets/results/<location>_results/<config_set>.<config_name>_<output_dataset>.csv`. If the model is run in the database option, these are also written to the database in `equitable-polling-locations.equitable_polling_locations_prod.<output_dataset>`.

1. ### *_results

    The optimizer returns a list of all pairs of census blocks and potential polling locations with a flag if they have been matched or not. The results dataset selects the pairs that have been matched and merges this with the intermediate dataset containing distances and demographics defined in [Intermediate datasets](intermediate_datasets.md).  This is the source table for the next three datasets. For each census block (id_orig), this table records the

    * polling location (id_dest) to which the census block is matched
    * the distance to this polling location
    * the address of the the polling location (if it exists)
    * the coordinates of the block centroid (orig_lat and orig_lon) and the coordinates of the destination (dest_lat and dest_lon)
    * population of each of the demographic groups per census block
    * It also reports block level weighted distances, KP factor, whether or not the matched location is new or historic.

1. ### *_precinct_distances
    
    Distances traveled to each precinct by demographic.  A melt of the results data for (currently asian, black, hispanic, native, population, white) and identified polling location (id_dest) and distance (distance_m). Then it calculates 

    * demo_pop, the total population sent to each precinct
    * weighted_dist = the total demo_pop weighted distance traveled by each demographic group
    * average distance traveled by the members of that demographic: $$average\hspace{1ex}distance = weighted\hspace{1ex}distance / demo\hspace{1ex}pop$$

1. ### *_residence_distances

    Distances traveled by demographic group in each census block. A melt of the results data for (currently asian, black, hispanic, native, population, white) and census block (id_orig) and distance (distance_m). _This is generated by the same process as the precinct data, substituting residence for precinct_. Then it calculates 

    * demo_pop, the total population sent to each precinct
    * weighted_dist = the total demo_pop weighted distance traveled by each demographic group
    * average distance traveled by the members of that demographic: $$average\hspace{1ex}distance = weighted\hspace{1ex}distance / demo\hspace{1ex}pop$$

 1. ### *_edes

     A derivative of the demographic_residents tables, this calculates the ***demographic level ede scores for the location***. For each demographic group (currently asian, black, hispanic, native, population, white), this table records the
    * demo_pop, the total population of that demographic in the location
    * average distance traveled by the members of that demographic: $$average\hspace{1ex}distance = weighted\hspace{1ex}distance / demo\hspace{1ex}pop$$
    * the $y_{EDE}$ for the demographic: $$y_{EDE} = \frac{-1} {( \beta * \alpha)*log(avg\hspace{1ex}KP\hspace{1ex}weight)}$$
    where $avg\hspace{1ex}KP\hspace{1ex}weight = (\sum demo\hspace{1ex}res\hspace{1ex}obj\hspace{1ex}summand)/demo\hspace{1ex}pop$


